{% load i18n %}
{% load static %}
<header id="page-topbar">
  <div class="layout-width">
    <div class="navbar-header">
      <div class="d-flex">
        <!-- LOGO -->
        <div class="navbar-brand-box horizontal-logo">
          <a href="" class="logo logo-dark">
            <span class="logo-sm">
              <img src="{% static 'assets/images/logo-sm.png' %}" alt="" height="22">
            </span>
            <span class="logo-lg">
              <img src="{% static 'assets/images/logo-dark.png' %}" alt="" height="17">
            </span>
          </a>
          <a href="" class="logo logo-light">
            <span class="logo-sm">
              <img src="{% static 'assets/images/logo-sm.png' %}" alt="" height="22">
            </span>
            <span class="logo-lg">
              <img src="{% static 'assets/images/logo-light.png' %}" alt="" height="17">
            </span>
          </a>
        </div>
        <button type="button" class="btn btn-sm px-3 fs-16 header-item vertical-menu-btn topnav-hamburger"
                id="topnav-hamburger-icon">
          <span class="hamburger-icon">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </button>
      </div>

<div class="d-flex align-items-center">
    <div class="dropdown ms-1 topbar-head-dropdown header-item">
       <button type="button" class="btn btn-icon btn-topbar btn-ghost-secondary rounded-circle"
               data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
         {% if request.LANGUAGE_CODE == 'uz' %}
           <img id="header-lang-img" src="{% static 'assets/images/flags/uz.svg' %}" alt="Uzbek" height="20" class="rounded">
         {% elif request.LANGUAGE_CODE == 'en' %}
           <img id="header-lang-img" src="{% static 'assets/images/flags/en.svg' %}" alt="English" height="20" class="rounded">
         {% elif request.LANGUAGE_CODE == 'ru' %}
           <img id="header-lang-img" src="{% static 'assets/images/flags/russia.svg' %}" alt="Russian" height="20" class="rounded">
         {% else %}
           <img id="header-lang-img" src="{% static 'assets/images/flags/default.svg' %}" alt="Default" height="20" class="rounded">
         {% endif %}
       </button>
       <div class="dropdown-menu dropdown-menu-end">
          {% for lang_code, lang_name in LANGUAGES %}
            <button type="button" class="dropdown-item notify-item language py-2"
                    data-lang="{{ lang_code }}" onclick="changeLanguage(this)">
              <img src="{% static 'assets/images/flags/'|add:lang_code|add:'.svg' %}" class="me-2 rounded" height="18">
              <span class="align-middle">{{ lang_name }}</span>
            </button>
          {% endfor %}
        </div>

    </div>

    <div class="ms-1 header-item d-none d-sm-flex">
      <button type="button" class="btn btn-icon btn-topbar btn-ghost-secondary rounded-circle light-dark-mode">
        <i class='bx bx-moon fs-22'></i>
      </button>
    </div>

    <div class="dropdown ms-sm-3 header-item topbar-user">
      <button type="button" class="btn" id="page-header-user-dropdown" data-bs-toggle="dropdown"
              aria-haspopup="true" aria-expanded="false">
        <span class="d-flex align-items-center">
          <img class="rounded-circle header-profile-user"
               src="{% static 'assets/images/users/avatar-1.jpg' %}"
               alt="Header Avatar">
          <span class="text-start ms-xl-2">
            <span
              class="d-none d-xl-inline-block ms-1 fw-semibold user-name-text">{{ request.user.first_name }} {{ request.user.second_name }}</span>
            <span class="d-none d-xl-block ms-1 fs-13 user-name-sub-text">{% if request.user.is_staff %}
              {% trans "Active" %}{% else %}{% trans "Inactive" %}{% endif %}</span>
          </span>
        </span>
      </button>
      <div class="dropdown-menu dropdown-menu-end">
        <a class="dropdown-item" href=""><i
          class="mdi mdi-account-circle text-muted fs-16 align-middle me-1"></i> <span
          class="align-middle">{% trans "Profile" %}</span></a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href=""><i
          class="mdi mdi-wallet text-muted fs-16 align-middle me-1"></i> <span class="align-middle">{% trans "Balance" %}: <b>$5971.67</b></span></a>
        <a class="dropdown-item" href=""><i
          class="mdi mdi-logout text-muted fs-16 align-middle me-1"></i> <span class="align-middle"
                                                                           data-key="t-logout">{% trans "Logout" %}</span></a>
      </div>
    </div>
  </div>

    </div>
  </div>
</header>

<script>
  function changeLanguage(button) {
  const language = button.getAttribute('data-lang');
  const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

  fetch("{% url 'set_language' %}", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-CSRFToken": csrfToken
    },
    body: JSON.stringify({language: language})
  })
  .then(response => {
    if (response.ok) {
      location.reload();
    } else {
      console.error("Tilni o'zgartirishda xatolik yuz berdi.");
    }
  });
}

</script>
