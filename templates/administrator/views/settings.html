{% extends 'administrator/main.html' %}
{% load static %}
{% block style %}
  <style>
      .form-control {
          border-radius: 0.375rem;
      }

      .form-label {
          font-weight: 600;
      }

      .form-section {
          background: #fff;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          margin-bottom: 20px;
      }

  </style>
  <style>
      .card-header {

          color: white;
      }

      .table-bordered th,
      .table-bordered td {
          vertical-align: middle;
      }

      .nav-tabs .nav-link img {
          vertical-align: middle;
          margin-right: 5px;
      }
  </style>
  <!-- SweetAlert2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">


{% endblock style %}

{% block content %}
  <div class="page-content">
    <div class="container-fluid">
      <h4 class="mb-3">Sayt Sozlamalarini Boshqarish</h4>

      <div class="card">
        <!-- Sayt Sozlamalari Formasi -->
        <form id="settingsForm" enctype="multipart/form-data" class="card-body">
          {% csrf_token %}
          <!-- Sayt nomi -->
          <div class="mb-3">
            <label for="site_name" class="form-label">Sayt nomi</label>
            <input type="text" class="form-control" id="site_name" name="site_name" value="{{ settings.site_name }}"
                   placeholder="Sayt nomini kiriting">
          </div>

          <!-- Logotiplar -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="logo_dark" class="form-label">Dark logotip</label>
              <input type="file" class="form-control" id="logo_dark" name="logo_dark">
              {% if settings.logo_dark %}
                <img src="{{ settings.logo_dark.url }}" alt="Dark Logotip" class="mt-2" style="width: 100px;">
              {% endif %}
            </div>
            <div class="col-md-6 mb-3">
              <label for="logo_light" class="form-label">Light logotip</label>
              <input type="file" class="form-control" id="logo_light" name="logo_light">
              {% if settings.logo_light %}
                <img src="{{ settings.logo_light.url }}" alt="Light Logotip" class="mt-2" style="width: 100px;">
              {% endif %}
            </div>
          </div>

          <!-- Aloqa Email va Telefon -->
          <div class="mb-3">
            <label for="contact_email" class="form-label">Aloqa Email</label>
            <input type="email" class="form-control" id="contact_email" name="contact_email"
                   value="{{ settings.contact_email }}" placeholder="Email manzilni kiriting">
          </div>
          <div class="mb-3">
            <label for="contact_phone" class="form-label">Aloqa Telefon</label>
            <input type="text" class="form-control" id="contact_phone" name="contact_phone"
                   value="{{ settings.contact_phone }}" placeholder="Telefon raqamini kiriting">
          </div>

          <!-- Kompaniya Manzili -->
          <div class="mb-3">
            <label for="address" class="form-label">Manzil</label>
            <textarea class="form-control" id="address" name="address" rows="3"
                      placeholder="Kompaniya manzilini kiriting">{{ settings.address }}</textarea>
          </div>

          <!-- Texnik xizmat rejimi -->
          <div class="form-check form-switch mb-4">
            <input class="form-check-input" type="checkbox" id="maintenance_mode" name="maintenance_mode"
                   {% if settings.maintenance_mode %}checked{% endif %}>
            <label class="form-check-label" for="maintenance_mode">Texnik xizmat rejimi</label>
          </div>

          <!-- Ijtimoiy Tarmoqlar Havolalari -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="facebook_url" class="form-label">Facebook URL</label>
              <input type="url" class="form-control" id="facebook_url" name="facebook_url"
                     value="{{ settings.facebook_url }}" placeholder="Facebook sahifa manzili">
            </div>
            <div class="col-md-6 mb-3">
              <label for="twitter_url" class="form-label">Twitter URL</label>
              <input type="url" class="form-control" id="twitter_url" name="twitter_url"
                     value="{{ settings.twitter_url }}" placeholder="Twitter sahifa manzili">
            </div>
            <div class="col-md-6 mb-3">
              <label for="instagram_url" class="form-label">Instagram URL</label>
              <input type="url" class="form-control" id="instagram_url" name="instagram_url"
                     value="{{ settings.instagram_url }}" placeholder="Instagram sahifa manzili">
            </div>
            <div class="col-md-6 mb-3">
              <label for="linkedin_url" class="form-label">LinkedIn URL</label>
              <input type="url" class="form-control" id="linkedin_url" name="linkedin_url"
                     value="{{ settings.linkedin_url }}" placeholder="LinkedIn sahifa manzili">
            </div>
          </div>

          <!-- Saqlash Tugmasi -->
          <button type="submit" class="btn btn-primary">Saqlash</button>
        </form>
      </div>

      <hr class="my-4">

      <div class="card">
        <!-- Aloqa Telefonlarini Boshqarish -->
        <div class="card-body">
          <!-- Telefonlar ro'yxati -->


          <!-- Yangi Telefon Qo'shish -->
          <form id="phoneForm" method="POST">
            {% csrf_token %}
            <div class="mb-3">
              <label for="phone_number" class="form-label fw-bold">Telefon raqami</label>
              <input type="text" class="form-control" id="phone_number" name="phone_number" placeholder="+998901234567">
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">Tavsif</label>
              <!-- Tabs -->
              <ul class="nav nav-tabs" role="tablist">
                {% for code, name in languages %}
                  <li class="nav-item">
                    <button class="nav-link {% if forloop.first %}active{% endif %}" id="{{ code }}-tab"
                            data-bs-toggle="tab" data-bs-target="#{{ code }}-content" type="button" role="tab"
                            aria-controls="{{ code }}-content" aria-selected="true">
                      <img src="{% static 'assets/images/flags/'|add:code|add:'.svg' %}" alt=""
                           style="width: 20px; margin-right: 5px;"> {{ name }}
                    </button>
                  </li>
                {% endfor %}
              </ul>

              <!-- Tabs Content -->
              <div class="tab-content mt-3">
                {% for code, name in languages %}
                  <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="{{ code }}-content"
                       role="tabpanel" aria-labelledby="{{ code }}-tab">
                    <textarea class="form-control" name="description_{{ code }}" id="description_{{ code }}"
                              placeholder="{{ name }} tavsifi"></textarea>
                  </div>
                {% endfor %}
              </div>
            </div>

            <button type="submit" class="btn btn-success w-100">Qo'shish</button>
          </form>
          <hr>
          <div class="text-white">
            <h4 class="mb-0">Aloqa Telefonlari</h4>
          </div>

          <table class="table table-bordered">
            <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Telefon raqami</th>
              <th>Tavsif</th>
              <th>Amallar</th>
            </tr>
            </thead>
            <tbody>
            {% for phone in contact_phones %}
              <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ phone.phone_number }}</td>
                <td>{{ phone.get_description }}</td>
                <td>
                  <a href="{% url 'contact-phone-delete' phone.id %}" class="btn btn-danger btn-sm">O'chirish</a>
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <hr>
<div class="card mt-4">
  <div class="card-body">
    <h5 class="card-title">Asosiy Sahifa Bannerlari</h5>
    <form id="bannerForm" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="mb-3">
        <label for="banner_image" class="form-label">Banner Rasm</label>
        <input type="file" class="form-control" id="banner_image" name="banner_image">
      </div>
      <div class="mb-3">
        <label for="banner_description" class="form-label">Tavsif</label>
        <ul class="nav nav-tabs">
          {% for code, name in languages %}
          <li class="nav-item">
            <a class="nav-link {% if forloop.first %}active{% endif %}" data-bs-toggle="tab" href="#banner_{{ code }}">
              {{ name }}
            </a>
          </li>
          {% endfor %}
        </ul>
        <div class="tab-content mt-3">
          {% for code, name in languages %}
          <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="banner_{{ code }}">
            <textarea class="form-control" name="banner_description_{{ code }}" placeholder="{{ name }} tavsifi"></textarea>
          </div>
          {% endfor %}
        </div>
      </div>
      <button type="button" class="btn btn-primary" id="submitBanner">Qo'shish</button>
    </form>
  </div>
</div>

<div class="card mt-4">
  <div class="card-body">
    <h5 class="card-title">Doctor A haqida Ma'lumot</h5>
    <form id="doctorAForm" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="mb-3">
        <label for="doctor_image" class="form-label">Rasm</label>
        <input type="file" class="form-control" id="doctor_image" name="doctor_image">
      </div>
      <div class="mb-3">
        <label for="doctor_title" class="form-label">Sarlavha</label>
        <ul class="nav nav-tabs">
          {% for code, name in languages %}
          <li class="nav-item">
            <a class="nav-link {% if forloop.first %}active{% endif %}" data-bs-toggle="tab"
               href="#doctor_title_{{ code }}">
              {{ name }}
            </a>
          </li>
          {% endfor %}
        </ul>
        <div class="tab-content mt-3">
          {% for code, name in languages %}
          <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="doctor_title_{{ code }}">
            <textarea class="form-control" name="doctor_title_{{ code }}" placeholder="{{ name }} sarlavha"></textarea>
          </div>
          {% endfor %}
        </div>
      </div>
      <button type="button" class="btn btn-primary" id="submitDoctorA">Qo'shish</button>
    </form>
  </div>
</div>
    </div>
  </div>
{% endblock %}



{% block script %}
  <!-- SweetAlert2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


  <script>
    function previewImage(event, previewId) {
      const fileInput = event.target;
      const file = fileInput.files[0];
      const preview = document.getElementById(previewId);

      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
        };
        reader.readAsDataURL(file);
      } else {
        preview.src = ''; // Agar fayl tanlanmasa, bo'shatiladi
      }
    }
  </script>

  <script>
    document.getElementById('phoneForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const formData = new FormData(this);
      fetch("{% url 'setting-view' %}", {
        method: 'POST',
        headers: {
          'X-CSRFToken': "{{ csrf_token }}",
        },
        body: formData,
      }).then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            // Muvaffaqiyatli xabar
            Swal.fire({
              icon: 'success',
              title: 'Muvaffaqiyatli!',
              text: 'Telefon ma\'lumotlari muvaffaqiyatli saqlandi!',
              confirmButtonText: 'OK',
              timer: 3000,
              timerProgressBar: true,
            }).then(() => {
              location.reload(); // Sahifani yangilash
            });
          } else {
            // Xatolik xabari
            Swal.fire({
              icon: 'error',
              title: 'Xatolik!',
              text: data.message || 'Ma\'lumotlar saqlanmadi!',
              confirmButtonText: 'OK',
            });
          }
        })
        .catch(error => {
          // Server bilan bog'liq xatolik xabari
          Swal.fire({
            icon: 'error',
            title: 'Xatolik!',
            text: 'Server bilan bog\'lanishda muammo yuz berdi!',
            confirmButtonText: 'OK',
          });
          console.error('Error:', error);
        });
    });
  </script>
  <script>
    // Formni yuborish uchun JavaScript
    document.getElementById('settingsForm').addEventListener('submit', function(e) {
      e.preventDefault(); // Formni default yuborilishini to'xtatish

      const formData = new FormData(this);

      fetch("{% url 'setting-view' %}", {
        method: 'POST',
        headers: {
          'X-CSRFToken': "{{ csrf_token }}", // CSRF token
        },
        body: formData,
      })
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            Swal.fire({
              icon: 'success',
              title: 'Muvaffaqiyatli!',
              text: 'Sayt sozlamalari saqlandi!',
              confirmButtonText: 'OK',
            }).then(() => {
              location.reload(); // Sahifani yangilash
            });
          } else {
            Swal.fire({
              icon: 'error',
              title: 'Xatolik!',
              text: 'Sayt sozlamalari saqlanmadi!',
              confirmButtonText: 'OK',
            });
          }
        })
        .catch(error => {
          Swal.fire({
            icon: 'error',
            title: 'Xatolik!',
            text: 'Server bilan aloqa o\'rnatishda muammo!',
            confirmButtonText: 'OK',
          });
        });
    });
  </script>
  <script>
  // Function to show SweetAlert notifications
function showSwal(status, message) {
  Swal.fire({
    icon: status,
    title: status === 'success' ? 'Muvaffaqiyatli!' : 'Xatolik!',
    text: message,
    confirmButtonText: 'OK',
  });
}

// AJAX for Banner Form Submission
document.getElementById('submitBanner').addEventListener('click', function () {
  const bannerForm = document.getElementById('bannerForm');
  const formData = new FormData(bannerForm);

  fetch("{% url 'setting-view' %}", {
    method: 'POST',
    headers: {
      'X-CSRFToken': "{{ csrf_token }}",
    },
    body: formData,
  })
    .then((response) => response.json())
    .then((data) => {
      if (data.status === 'success') {
        showSwal('success', data.message);
        bannerForm.reset(); // Reset the form
      } else {
        showSwal('error', data.message);
      }
    })
    .catch((error) => showSwal('error', 'Xatolik yuz berdi!'));
});

// AJAX for Doctor A Form Submission
document.getElementById('submitDoctorA').addEventListener('click', function () {
  const doctorAForm = document.getElementById('doctorAForm');
  const formData = new FormData(doctorAForm);

  fetch("{% url 'setting-view' %}", {
    method: 'POST',
    headers: {
      'X-CSRFToken': "{{ csrf_token }}",
    },
    body: formData,
  })
    .then((response) => response.json())
    .then((data) => {
      if (data.status === 'success') {
        showSwal('success', data.message);
        doctorAForm.reset(); // Reset the form
      } else {
        showSwal('error', data.message);
      }
    })
    .catch((error) => showSwal('error', 'Xatolik yuz berdi!'));
});
  </script>
{% endblock script %}
