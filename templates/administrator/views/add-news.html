{% extends 'administrator/main.html' %}
{% load static %}
{% block style %}
<link rel="stylesheet" href="{% static 'css/custom-style.css' %}">
{% endblock style %}

{% block content %}
<div class="page-content">
   <div class="container-fluid">
      <div class="card shadow-sm">
         <div class="card-header">
            <h5 class="mb-0">Yangi Yangilik Qoâ€˜shish</h5>
         </div>
         <div class="card-body">
            <form method="post" enctype="multipart/form-data">
               {% csrf_token %}
               
               <!-- Tabs for Titles -->
               <ul class="nav nav-tabs" id="title-tabs" role="tablist">
                  {% for code, name in LANGUAGES %}
                  <li class="nav-item" role="presentation">
                     <button class="nav-link {% if forloop.first %}active{% endif %}" id="title-tab-{{ code }}" data-bs-toggle="tab" data-bs-target="#title-{{ code }}" type="button" role="tab" aria-controls="title-{{ code }}" aria-selected="true">
                        {{ name }}
                     </button>
                  </li>
                  {% endfor %}
               </ul>

               <!-- Tab Content for Titles -->
               <div class="tab-content mt-3">
                  {% for code, name in LANGUAGES %}
                  <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="title-{{ code }}" role="tabpanel" aria-labelledby="title-tab-{{ code }}">
                     <div class="mb-3">
                        <label for="title_{{ code }}" class="form-label">Sarlavha ({{ name }})</label>
                        <input type="text" id="title_{{ code }}" name="title[{{ code }}]" class="form-control" placeholder="Sarlavha ({{ name }})">
                     </div>
                  </div>
                  {% endfor %}
               </div>

               <!-- Tabs for Content -->
               <ul class="nav nav-tabs" id="content-tabs" role="tablist">
                  {% for code, name in LANGUAGES %}
                  <li class="nav-item" role="presentation">
                     <button class="nav-link {% if forloop.first %}active{% endif %}" id="content-tab-{{ code }}" data-bs-toggle="tab" data-bs-target="#content-{{ code }}" type="button" role="tab" aria-controls="content-{{ code }}" aria-selected="true">
                        {{ name }}
                     </button>
                  </li>
                  {% endfor %}
               </ul>

               <!-- Tab Content for Content -->
               <div class="tab-content mt-3">
                  {% for code, name in LANGUAGES %}
                  <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="content-{{ code }}" role="tabpanel" aria-labelledby="content-tab-{{ code }}">
                     <div class="mb-3">
                        <label for="content_{{ code }}" class="form-label">Mazmun ({{ name }})</label>
                        <textarea id="content_{{ code }}" name="content[{{ code }}]" class="form-control" rows="3" placeholder="Mazmun ({{ name }})"></textarea>
                     </div>
                  </div>
                  {% endfor %}
               </div>

               <!-- Image -->
               <div class="mb-3">
                  <label for="image" class="form-label">Rasm</label>
                  <input type="file" id="image" name="image" class="form-control">
               </div>

               <!-- Publish date -->
               <div class="mb-3">
                  <label for="published_date" class="form-label">Chop etilgan sana</label>
                  <input type="date" id="published_date" name="published_date" class="form-control">
               </div>

               <!-- Is published -->
               <div class="form-check form-switch mb-3">
                  <input type="checkbox" id="is_published" name="is_published" class="form-check-input">
                  <label for="is_published" class="form-check-label">Chop etilgan</label>
               </div>

               <!-- Submit button -->
               <div class="text-end">
                  <button type="submit" class="btn btn-primary">Saqlash</button>
                  <a href="{% url 'news-view' %}" class="btn btn-secondary">Bekor qilish</a>
               </div>
            </form>
         </div>
      </div>
   </div>
</div>
{% endblock content %}

{% block script %}
<script>
document.querySelector('form').addEventListener('submit', function (event) {
    event.preventDefault();

    const formData = new FormData(this);
    fetch("{% url 'add-news-view' %}", {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === "success") {
            Swal.fire({
                icon: "success",
                title: "Muvaffaqiyatli!",
                text: data.message,
                confirmButtonText: "OK"
            }).then(() => {
                location.reload(); // Sahifani yangilash
            });
        } else {
            Swal.fire({
                icon: "error",
                title: "Xatolik!",
                text: data.message,
                confirmButtonText: "OK"
            });
        }
    })
    .catch(err => console.error("Error:", err));
});
</script>
{% endblock script %}
